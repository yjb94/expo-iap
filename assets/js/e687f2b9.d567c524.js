"use strict";(self.webpackChunkexpo_iap_docs=self.webpackChunkexpo_iap_docs||[]).push([[1710],{571:(r,e,n)=>{n.d(e,{A:()=>l});var s=n(6540),o=n(4848);function i({className:r="adfit",style:e,unit:n,height:i,width:l}){return(0,s.useEffect)(()=>{const e=setTimeout(()=>{const e=document.querySelector(`.${r}`);if(!e)return void console.warn(`AdFit: Element with class "${r}" not found`);const s=e.querySelectorAll(".kakao_ad_area"),o=e.querySelectorAll('script[src*="kas/static/ba.min.js"]');s.forEach(r=>r.remove()),o.forEach(r=>r.remove());const d=document.createElement("ins"),t=document.createElement("script");d.className="kakao_ad_area",d.style.cssText="display:none; width:100%;",t.async=!0,t.type="text/javascript",t.src="//t1.daumcdn.net/kas/static/ba.min.js",d.setAttribute("data-ad-width",l.toString()),d.setAttribute("data-ad-height",i.toString()),d.setAttribute("data-ad-unit",n),e.appendChild(d),e.appendChild(t)},100);return()=>clearTimeout(e)},[r,n,i,l]),(0,o.jsx)("div",{style:e,children:(0,o.jsx)("div",{className:r})})}function l(){return(0,o.jsx)(i,{unit:"DAN-YTmjDwlbcP42HBg6",height:100,width:320,className:"adfit-top",style:{flex:1,marginTop:24,marginBottom:24}})}},4516:(r,e,n)=>{n.r(e),n.d(e,{assets:()=>c,contentTitle:()=>t,default:()=>E,frontMatter:()=>d,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"api/error-codes","title":"Error Codes","description":"Expo IAP provides a centralized error handling system with platform-specific error code mapping. This ensures consistent error handling across iOS and Android platforms.","source":"@site/docs/api/error-codes.md","sourceDirName":"api","slug":"/api/error-codes","permalink":"/docs/api/error-codes","draft":false,"unlisted":false,"editUrl":"https://github.com/hyochan/expo-iap/tree/main/docs/docs/api/error-codes.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"useIAP Hook","permalink":"/docs/api/use-iap"},"next":{"title":"Basic Store","permalink":"/docs/examples/basic-store"}}');var o=n(4848),i=n(8453),l=n(571);const d={sidebar_position:2},t="Error Codes",c={},a=[{value:"Error Code Enum",id:"error-code-enum",level:2},{value:"ErrorCode",id:"errorcode",level:3},{value:"Error Descriptions",id:"error-descriptions",level:2},{value:"Common Errors",id:"common-errors",level:3},{value:"E_UNKNOWN",id:"e_unknown",level:4},{value:"E_USER_CANCELLED",id:"e_user_cancelled",level:4},{value:"E_NETWORK_ERROR",id:"e_network_error",level:4},{value:"E_SERVICE_ERROR",id:"e_service_error",level:4},{value:"E_ITEM_UNAVAILABLE",id:"e_item_unavailable",level:4},{value:"iOS-Specific Errors",id:"ios-specific-errors",level:3},{value:"E_RECEIPT_FAILED",id:"e_receipt_failed",level:4},{value:"E_DEFERRED_PAYMENT",id:"e_deferred_payment",level:4},{value:"E_TRANSACTION_VALIDATION_FAILED",id:"e_transaction_validation_failed",level:4},{value:"Android-Specific Errors",id:"android-specific-errors",level:3},{value:"E_BILLING_RESPONSE_JSON_PARSE_ERROR",id:"e_billing_response_json_parse_error",level:4},{value:"E_ALREADY_OWNED",id:"e_already_owned",level:4},{value:"PurchaseError Class",id:"purchaseerror-class",level:2},{value:"Constructor",id:"constructor",level:3},{value:"Static Methods",id:"static-methods",level:3},{value:"fromPlatformError",id:"fromplatformerror",level:4},{value:"Instance Methods",id:"instance-methods",level:3},{value:"getPlatformCode",id:"getplatformcode",level:4},{value:"ErrorCodeUtils",id:"errorcodeutils",level:2},{value:"getNativeErrorCode",id:"getnativeerrorcode",level:3},{value:"fromPlatformCode",id:"fromplatformcode",level:3},{value:"toPlatformCode",id:"toplatformcode",level:3},{value:"isValidForPlatform",id:"isvalidforplatform",level:3},{value:"Platform Error Code Mappings",id:"platform-error-code-mappings",level:2},{value:"iOS Error Codes",id:"ios-error-codes",level:3},{value:"Android Error Codes",id:"android-error-codes",level:3},{value:"Usage Examples",id:"usage-examples",level:2},{value:"Basic Error Handling",id:"basic-error-handling",level:3},{value:"Advanced Error Handling with Retry Logic",id:"advanced-error-handling-with-retry-logic",level:3},{value:"Error Logging and Analytics",id:"error-logging-and-analytics",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"See Also",id:"see-also",level:2}];function h(r){const e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...r.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(e.header,{children:(0,o.jsx)(e.h1,{id:"error-codes",children:"Error Codes"})}),"\n",(0,o.jsx)(l.A,{}),"\n",(0,o.jsx)(e.p,{children:"Expo IAP provides a centralized error handling system with platform-specific error code mapping. This ensures consistent error handling across iOS and Android platforms."}),"\n",(0,o.jsx)(e.h2,{id:"error-code-enum",children:"Error Code Enum"}),"\n",(0,o.jsx)(e.h3,{id:"errorcode",children:"ErrorCode"}),"\n",(0,o.jsxs)(e.p,{children:["The ",(0,o.jsx)(e.code,{children:"ErrorCode"})," enum provides standardized error codes that map to platform-specific errors:"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-tsx",children:"import {ErrorCode} from 'expo-iap';\n\nenum ErrorCode {\n  E_UNKNOWN = 'E_UNKNOWN',\n  E_USER_CANCELLED = 'E_USER_CANCELLED',\n  E_USER_ERROR = 'E_USER_ERROR',\n  E_ITEM_UNAVAILABLE = 'E_ITEM_UNAVAILABLE',\n  E_REMOTE_ERROR = 'E_REMOTE_ERROR',\n  E_NETWORK_ERROR = 'E_NETWORK_ERROR',\n  E_SERVICE_ERROR = 'E_SERVICE_ERROR',\n  E_RECEIPT_FAILED = 'E_RECEIPT_FAILED',\n  E_RECEIPT_FINISHED_FAILED = 'E_RECEIPT_FINISHED_FAILED',\n  E_NOT_PREPARED = 'E_NOT_PREPARED',\n  E_NOT_ENDED = 'E_NOT_ENDED',\n  E_ALREADY_OWNED = 'E_ALREADY_OWNED',\n  E_DEVELOPER_ERROR = 'E_DEVELOPER_ERROR',\n  E_BILLING_RESPONSE_JSON_PARSE_ERROR = 'E_BILLING_RESPONSE_JSON_PARSE_ERROR',\n  E_DEFERRED_PAYMENT = 'E_DEFERRED_PAYMENT',\n  E_INTERRUPTED = 'E_INTERRUPTED',\n  E_IAP_NOT_AVAILABLE = 'E_IAP_NOT_AVAILABLE',\n  E_PURCHASE_ERROR = 'E_PURCHASE_ERROR',\n  E_SYNC_ERROR = 'E_SYNC_ERROR',\n  E_TRANSACTION_VALIDATION_FAILED = 'E_TRANSACTION_VALIDATION_FAILED',\n  E_ACTIVITY_UNAVAILABLE = 'E_ACTIVITY_UNAVAILABLE',\n  E_ALREADY_PREPARED = 'E_ALREADY_PREPARED',\n  E_PENDING = 'E_PENDING',\n  E_CONNECTION_CLOSED = 'E_CONNECTION_CLOSED',\n}\n"})}),"\n",(0,o.jsx)(e.h2,{id:"error-descriptions",children:"Error Descriptions"}),"\n",(0,o.jsx)(e.h3,{id:"common-errors",children:"Common Errors"}),"\n",(0,o.jsx)(e.h4,{id:"e_unknown",children:"E_UNKNOWN"}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"Description"}),": Unknown or unspecified error"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"When it occurs"}),": Fallback for unmapped errors"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"User action"}),": General error handling, retry or contact support"]}),"\n"]}),"\n",(0,o.jsx)(e.h4,{id:"e_user_cancelled",children:"E_USER_CANCELLED"}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"Description"}),": User cancelled the purchase"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"When it occurs"}),': User taps "Cancel" in the payment dialog']}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"User action"}),": No action needed, this is normal user behavior"]}),"\n"]}),"\n",(0,o.jsx)(e.h4,{id:"e_network_error",children:"E_NETWORK_ERROR"}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"Description"}),": Network connection failed"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"When it occurs"}),": No internet connection or network timeout"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"User action"}),": Check internet connection and retry"]}),"\n"]}),"\n",(0,o.jsx)(e.h4,{id:"e_service_error",children:"E_SERVICE_ERROR"}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"Description"}),": App Store/Play Store service error"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"When it occurs"}),": Store servers are down or experiencing issues"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"User action"}),": Try again later"]}),"\n"]}),"\n",(0,o.jsx)(e.h4,{id:"e_item_unavailable",children:"E_ITEM_UNAVAILABLE"}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"Description"}),": The requested item is not available for purchase"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"When it occurs"}),": Product not found in store or not available in user's region"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"User action"}),": Check product availability"]}),"\n"]}),"\n",(0,o.jsx)(e.h3,{id:"ios-specific-errors",children:"iOS-Specific Errors"}),"\n",(0,o.jsx)(e.h4,{id:"e_receipt_failed",children:"E_RECEIPT_FAILED"}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"Description"}),": Receipt validation failed"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"When it occurs"}),": Invalid receipt data or validation error"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"User action"}),": Retry purchase or contact support"]}),"\n"]}),"\n",(0,o.jsx)(e.h4,{id:"e_deferred_payment",children:"E_DEFERRED_PAYMENT"}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"Description"}),": Payment is deferred (requires parental approval)"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"When it occurs"}),": Family Sharing with Ask to Buy enabled"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"User action"}),": Wait for approval"]}),"\n"]}),"\n",(0,o.jsx)(e.h4,{id:"e_transaction_validation_failed",children:"E_TRANSACTION_VALIDATION_FAILED"}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"Description"}),": Transaction validation failed"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"When it occurs"}),": StoreKit transaction validation error"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"User action"}),": Retry or contact support"]}),"\n"]}),"\n",(0,o.jsx)(e.h3,{id:"android-specific-errors",children:"Android-Specific Errors"}),"\n",(0,o.jsx)(e.h4,{id:"e_billing_response_json_parse_error",children:"E_BILLING_RESPONSE_JSON_PARSE_ERROR"}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"Description"}),": Failed to parse billing response"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"When it occurs"}),": Invalid response from Google Play Billing"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"User action"}),": Retry purchase"]}),"\n"]}),"\n",(0,o.jsx)(e.h4,{id:"e_already_owned",children:"E_ALREADY_OWNED"}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"Description"}),": User already owns this item"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"When it occurs"}),": Attempting to buy a non-consumable product already owned"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"User action"}),": Restore purchases or contact support"]}),"\n"]}),"\n",(0,o.jsx)(e.h2,{id:"purchaseerror-class",children:"PurchaseError Class"}),"\n",(0,o.jsx)(e.h3,{id:"constructor",children:"Constructor"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-tsx",children:"class PurchaseError implements Error {\n  constructor(\n    public name: string,\n    public message: string,\n    public responseCode?: number,\n    public debugMessage?: string,\n    public code?: ErrorCode,\n    public productId?: string,\n    public platform?: 'ios' | 'android',\n  )\n}\n"})}),"\n",(0,o.jsx)(e.h3,{id:"static-methods",children:"Static Methods"}),"\n",(0,o.jsx)(e.h4,{id:"fromplatformerror",children:"fromPlatformError"}),"\n",(0,o.jsxs)(e.p,{children:["Creates a ",(0,o.jsx)(e.code,{children:"PurchaseError"})," from platform-specific error data:"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-tsx",children:"static fromPlatformError(\n  errorData: any,\n  platform: 'ios' | 'android',\n): PurchaseError\n"})}),"\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.strong,{children:"Example"}),":"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-tsx",children:"const error = PurchaseError.fromPlatformError(\n  {code: 2, message: 'User cancelled'},\n  'ios',\n);\nconsole.log(error.code); // ErrorCode.E_USER_CANCELLED\n"})}),"\n",(0,o.jsx)(e.h3,{id:"instance-methods",children:"Instance Methods"}),"\n",(0,o.jsx)(e.h4,{id:"getplatformcode",children:"getPlatformCode"}),"\n",(0,o.jsx)(e.p,{children:"Gets the platform-specific error code:"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-tsx",children:"getPlatformCode(): string | number | undefined\n"})}),"\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.strong,{children:"Example"}),":"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-tsx",children:"const error = new PurchaseError(\n  'PurchaseError',\n  'User cancelled',\n  undefined,\n  undefined,\n  ErrorCode.E_USER_CANCELLED,\n  'com.app.premium',\n  'ios',\n);\n\nconsole.log(error.getPlatformCode()); // 2 (iOS code)\n"})}),"\n",(0,o.jsx)(e.h2,{id:"errorcodeutils",children:"ErrorCodeUtils"}),"\n",(0,o.jsx)(e.p,{children:"Utility functions for error code mapping and validation."}),"\n",(0,o.jsx)(e.h3,{id:"getnativeerrorcode",children:"getNativeErrorCode"}),"\n",(0,o.jsx)(e.p,{children:"Gets the native error code for the current platform:"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-tsx",children:"ErrorCodeUtils.getNativeErrorCode(errorCode: ErrorCode): string\n"})}),"\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.strong,{children:"Example"}),":"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-tsx",children:"const nativeCode = ErrorCodeUtils.getNativeErrorCode(\n  ErrorCode.E_USER_CANCELLED,\n);\nconsole.log(nativeCode); // Platform-specific code\n"})}),"\n",(0,o.jsx)(e.h3,{id:"fromplatformcode",children:"fromPlatformCode"}),"\n",(0,o.jsx)(e.p,{children:"Maps platform-specific error code to standardized ErrorCode:"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-tsx",children:"ErrorCodeUtils.fromPlatformCode(\n  platformCode: string | number,\n  platform: 'ios' | 'android',\n): ErrorCode\n"})}),"\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.strong,{children:"Example"}),":"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-tsx",children:"// iOS\nconst errorCode = ErrorCodeUtils.fromPlatformCode(2, 'ios');\nconsole.log(errorCode); // ErrorCode.E_USER_CANCELLED\n\n// Android\nconst errorCode = ErrorCodeUtils.fromPlatformCode(\n  'E_USER_CANCELLED',\n  'android',\n);\nconsole.log(errorCode); // ErrorCode.E_USER_CANCELLED\n"})}),"\n",(0,o.jsx)(e.h3,{id:"toplatformcode",children:"toPlatformCode"}),"\n",(0,o.jsx)(e.p,{children:"Maps ErrorCode to platform-specific code:"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-tsx",children:"ErrorCodeUtils.toPlatformCode(\n  errorCode: ErrorCode,\n  platform: 'ios' | 'android',\n): string | number\n"})}),"\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.strong,{children:"Example"}),":"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-tsx",children:"// iOS\nconst iosCode = ErrorCodeUtils.toPlatformCode(\n  ErrorCode.E_USER_CANCELLED,\n  'ios',\n);\nconsole.log(iosCode); // 2\n\n// Android\nconst androidCode = ErrorCodeUtils.toPlatformCode(\n  ErrorCode.E_USER_CANCELLED,\n  'android',\n);\nconsole.log(androidCode); // 'E_USER_CANCELLED'\n"})}),"\n",(0,o.jsx)(e.h3,{id:"isvalidforplatform",children:"isValidForPlatform"}),"\n",(0,o.jsx)(e.p,{children:"Checks if error code is valid for the specified platform:"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-tsx",children:"ErrorCodeUtils.isValidForPlatform(\n  errorCode: ErrorCode,\n  platform: 'ios' | 'android',\n): boolean\n"})}),"\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.strong,{children:"Example"}),":"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-tsx",children:"const isValid = ErrorCodeUtils.isValidForPlatform(\n  ErrorCode.E_USER_CANCELLED,\n  'ios',\n);\nconsole.log(isValid); // true\n"})}),"\n",(0,o.jsx)(e.h2,{id:"platform-error-code-mappings",children:"Platform Error Code Mappings"}),"\n",(0,o.jsx)(e.h3,{id:"ios-error-codes",children:"iOS Error Codes"}),"\n",(0,o.jsxs)(e.table,{children:[(0,o.jsx)(e.thead,{children:(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.th,{children:"ErrorCode"}),(0,o.jsx)(e.th,{children:"iOS Code"}),(0,o.jsx)(e.th,{children:"StoreKit Error"})]})}),(0,o.jsxs)(e.tbody,{children:[(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:"E_UNKNOWN"}),(0,o.jsx)(e.td,{children:"0"}),(0,o.jsx)(e.td,{children:"SKErrorUnknown"})]}),(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:"E_USER_CANCELLED"}),(0,o.jsx)(e.td,{children:"2"}),(0,o.jsx)(e.td,{children:"SKErrorPaymentCancelled"})]}),(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:"E_SERVICE_ERROR"}),(0,o.jsx)(e.td,{children:"1"}),(0,o.jsx)(e.td,{children:"SKErrorClientInvalid"})]}),(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:"E_ITEM_UNAVAILABLE"}),(0,o.jsx)(e.td,{children:"4"}),(0,o.jsx)(e.td,{children:"SKErrorProductNotAvailable"})]}),(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:"E_NETWORK_ERROR"}),(0,o.jsx)(e.td,{children:"6"}),(0,o.jsx)(e.td,{children:"SKErrorNetworkError"})]})]})]}),"\n",(0,o.jsx)(e.h3,{id:"android-error-codes",children:"Android Error Codes"}),"\n",(0,o.jsxs)(e.table,{children:[(0,o.jsx)(e.thead,{children:(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.th,{children:"ErrorCode"}),(0,o.jsx)(e.th,{children:"Android Code"}),(0,o.jsx)(e.th,{children:"Billing Response"})]})}),(0,o.jsxs)(e.tbody,{children:[(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:"E_UNKNOWN"}),(0,o.jsx)(e.td,{children:"E_UNKNOWN"}),(0,o.jsx)(e.td,{children:"BILLING_UNAVAILABLE"})]}),(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:"E_USER_CANCELLED"}),(0,o.jsx)(e.td,{children:"E_USER_CANCELLED"}),(0,o.jsx)(e.td,{children:"USER_CANCELED"})]}),(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:"E_SERVICE_ERROR"}),(0,o.jsx)(e.td,{children:"E_SERVICE_ERROR"}),(0,o.jsx)(e.td,{children:"SERVICE_UNAVAILABLE"})]}),(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:"E_ITEM_UNAVAILABLE"}),(0,o.jsx)(e.td,{children:"E_ITEM_UNAVAILABLE"}),(0,o.jsx)(e.td,{children:"ITEM_UNAVAILABLE"})]}),(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:"E_DEVELOPER_ERROR"}),(0,o.jsx)(e.td,{children:"E_DEVELOPER_ERROR"}),(0,o.jsx)(e.td,{children:"DEVELOPER_ERROR"})]})]})]}),"\n",(0,o.jsx)(e.h2,{id:"usage-examples",children:"Usage Examples"}),"\n",(0,o.jsx)(e.h3,{id:"basic-error-handling",children:"Basic Error Handling"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-tsx",children:"import {useIAP, ErrorCode, PurchaseError} from 'expo-iap';\n\nconst {requestPurchase} = useIAP({\n  onPurchaseError: (error: PurchaseError) => {\n    console.log('Error details:', {\n      code: error.code,\n      message: error.message,\n      platform: error.platform,\n      platformCode: error.getPlatformCode(),\n    });\n\n    switch (error.code) {\n      case ErrorCode.E_USER_CANCELLED:\n        // Don't show error for user cancellation\n        break;\n      case ErrorCode.E_NETWORK_ERROR:\n        Alert.alert('Network Error', 'Please check your internet connection');\n        break;\n      case ErrorCode.E_ITEM_UNAVAILABLE:\n        Alert.alert('Item Unavailable', 'This item is not available');\n        break;\n      default:\n        Alert.alert('Purchase Failed', error.message);\n    }\n  },\n});\n"})}),"\n",(0,o.jsx)(e.h3,{id:"advanced-error-handling-with-retry-logic",children:"Advanced Error Handling with Retry Logic"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-tsx",children:"const handlePurchaseWithRetry = async (productId: string, retryCount = 0) => {\n  const MAX_RETRIES = 2;\n\n  try {\n    await requestPurchase({\n      request: {\n        ios: { sku: productId },\n        android: { skus: [productId] }\n      }\n    });\n  } catch (error: any) {\n    const purchaseError = PurchaseError.fromPlatformError(error, Platform.OS);\n\n    // Determine if we should retry\n    const retryableErrors = [\n      ErrorCode.E_NETWORK_ERROR,\n      ErrorCode.E_SERVICE_ERROR,\n      ErrorCode.E_INTERRUPTED,\n    ];\n\n    const shouldRetry =\n      retryableErrors.includes(purchaseError.code!) && retryCount < MAX_RETRIES;\n\n    if (shouldRetry) {\n      console.log(`Retrying purchase (${retryCount + 1}/${MAX_RETRIES})`);\n      setTimeout(() => {\n        handlePurchaseWithRetry(productId, retryCount + 1);\n      }, 1000);\n    } else {\n      handlePurchaseError(purchaseError);\n    }\n  }\n};\n"})}),"\n",(0,o.jsx)(e.h3,{id:"error-logging-and-analytics",children:"Error Logging and Analytics"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-tsx",children:"const logError = (error: PurchaseError) => {\n  // Log to analytics service\n  analytics.track('purchase_error', {\n    error_code: error.code,\n    platform_code: error.getPlatformCode(),\n    platform: error.platform,\n    product_id: error.productId,\n    message: error.message,\n  });\n\n  // Log to crash reporting\n  crashlytics.recordError(error);\n};\n\nconst {requestPurchase} = useIAP({\n  onPurchaseError: (error) => {\n    logError(error);\n    showUserFriendlyError(error);\n  },\n});\n"})}),"\n",(0,o.jsx)(e.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,o.jsxs)(e.ol,{children:["\n",(0,o.jsxs)(e.li,{children:["\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.strong,{children:"Always validate receipts server-side"}),": While Expo IAP provides built-in ",(0,o.jsx)(e.code,{children:"validateReceiptIos"})," and ",(0,o.jsx)(e.code,{children:"validateReceiptAndroid"})," functions for client-side validation, this is not safe for production. Always implement server-side receipt validation for both platforms:"]}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsx)(e.li,{children:(0,o.jsx)(e.a,{href:"https://developer.apple.com/documentation/storekit/validating-receipts-with-the-app-store",children:"iOS Receipt Validation"})}),"\n",(0,o.jsx)(e.li,{children:(0,o.jsx)(e.a,{href:"https://developer.android.com/google/play/licensing/server-side-verification",children:"Android Receipt Validation"})}),"\n"]}),"\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.strong,{children:"Important"}),": Always call ",(0,o.jsx)(e.code,{children:"finishTransaction"})," after successful receipt validation. Failing to finish transactions may result in automatic purchase cancellation."]}),"\n"]}),"\n",(0,o.jsxs)(e.li,{children:["\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.strong,{children:"Understand the purchase lifecycle"}),": Familiarize yourself with the complete purchase flow and lifecycle management. See ",(0,o.jsx)(e.a,{href:"../guides/lifecycle",children:"Purchase Lifecycle Guide"})," for detailed information."]}),"\n"]}),"\n",(0,o.jsxs)(e.li,{children:["\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.strong,{children:"Implement comprehensive error handling"}),": Use the error codes for proper error handling logic. See ",(0,o.jsx)(e.a,{href:"./error-codes",children:"Error Codes Reference"})," for complete error handling patterns."]}),"\n"]}),"\n",(0,o.jsxs)(e.li,{children:["\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.strong,{children:"Test thoroughly"}),": Test with sandbox accounts and real devices. In-app purchases don't work in simulators/emulators."]}),"\n"]}),"\n",(0,o.jsxs)(e.li,{children:["\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.strong,{children:"Restore purchases"}),": Implement purchase restoration for non-consumable products and subscriptions."]}),"\n"]}),"\n",(0,o.jsxs)(e.li,{children:["\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.strong,{children:"Use open-source solutions for server validation"}),": Consider these libraries to make server-side validation easier:"]}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.a,{href:"https://github.com/jeremybarbet/iap",children:"iap"})," - Universal IAP validation library"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.a,{href:"https://github.com/ladeiko/node-apple-receipt-verify",children:"node-apple-receipt-verify"})," - Apple receipt validation for Node.js"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(e.h2,{id:"see-also",children:"See Also"}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsx)(e.li,{children:(0,o.jsx)(e.a,{href:"../guides/error-handling",children:"Error Handling Guide"})}),"\n",(0,o.jsx)(e.li,{children:(0,o.jsx)(e.a,{href:"./use-iap",children:"useIAP Hook"})}),"\n",(0,o.jsx)(e.li,{children:(0,o.jsx)(e.a,{href:"./types",children:"Types Reference"})}),"\n",(0,o.jsx)(e.li,{children:(0,o.jsx)(e.a,{href:"../guides/troubleshooting",children:"Troubleshooting"})}),"\n"]})]})}function E(r={}){const{wrapper:e}={...(0,i.R)(),...r.components};return e?(0,o.jsx)(e,{...r,children:(0,o.jsx)(h,{...r})}):h(r)}},8453:(r,e,n)=>{n.d(e,{R:()=>l,x:()=>d});var s=n(6540);const o={},i=s.createContext(o);function l(r){const e=s.useContext(i);return s.useMemo(function(){return"function"==typeof r?r(e):{...e,...r}},[e,r])}function d(r){let e;return e=r.disableParentContext?"function"==typeof r.components?r.components(o):r.components||o:l(r.components),s.createElement(i.Provider,{value:e},r.children)}}}]);