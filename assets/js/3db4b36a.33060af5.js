"use strict";(self.webpackChunkexpo_iap_docs=self.webpackChunkexpo_iap_docs||[]).push([[4454],{571:(e,n,s)=>{s.d(n,{A:()=>o});var r=s(6540),i=s(4848);function t({className:e="adfit",style:n,unit:s,height:t,width:o}){return(0,r.useEffect)(()=>{const n=setTimeout(()=>{const n=document.querySelector(`.${e}`);if(!n)return void console.warn(`AdFit: Element with class "${e}" not found`);const r=n.querySelectorAll(".kakao_ad_area"),i=n.querySelectorAll('script[src*="kas/static/ba.min.js"]');r.forEach(e=>e.remove()),i.forEach(e=>e.remove());const c=document.createElement("ins"),d=document.createElement("script");c.className="kakao_ad_area",c.style.cssText="display:none; width:100%;",d.async=!0,d.type="text/javascript",d.src="//t1.daumcdn.net/kas/static/ba.min.js",c.setAttribute("data-ad-width",o.toString()),c.setAttribute("data-ad-height",t.toString()),c.setAttribute("data-ad-unit",s),n.appendChild(c),n.appendChild(d)},100);return()=>clearTimeout(n)},[e,s,t,o]),(0,i.jsx)("div",{style:n,children:(0,i.jsx)("div",{className:e})})}function o(){return(0,i.jsx)(t,{unit:"DAN-YTmjDwlbcP42HBg6",height:100,width:320,className:"adfit-top",style:{flex:1,marginTop:24,marginBottom:24}})}},7294:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>d,default:()=>p,frontMatter:()=>c,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"getting-started/setup-android","title":"Android Setup","description":"For complete Android setup instructions including Google Play Console configuration, app setup, and testing guidelines, please visit:","source":"@site/docs/getting-started/setup-android.md","sourceDirName":"getting-started","slug":"/getting-started/setup-android","permalink":"/docs/getting-started/setup-android","draft":false,"unlisted":false,"editUrl":"https://github.com/hyochan/expo-iap/tree/main/docs/docs/getting-started/setup-android.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"iOS Setup","permalink":"/docs/getting-started/setup-ios"},"next":{"title":"Purchases","permalink":"/docs/guides/purchases"}}');var i=s(4848),t=s(8453),o=s(571);const c={sidebar_position:2},d="Android Setup",a={},l=[{value:"App Configuration",id:"app-configuration",level:2},{value:"Code Integration",id:"code-integration",level:2},{value:"Basic Setup",id:"basic-setup",level:3},{value:"Android-Specific Product Handling",id:"android-specific-product-handling",level:3},{value:"Error Handling for Android",id:"error-handling-for-android",level:3},{value:"Common Issues",id:"common-issues",level:2},{value:"Product IDs Not Found",id:"product-ids-not-found",level:3},{value:"Testing Issues",id:"testing-issues",level:3},{value:"Purchase Flow Issues",id:"purchase-flow-issues",level:3},{value:"Subscription Issues",id:"subscription-issues",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Android-Specific Features",id:"android-specific-features",level:2},{value:"Proration for Subscription Changes",id:"proration-for-subscription-changes",level:3},{value:"Pending Purchases",id:"pending-purchases",level:3},{value:"Next Steps",id:"next-steps",level:2}];function u(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"android-setup",children:"Android Setup"})}),"\n",(0,i.jsx)(o.A,{}),"\n",(0,i.jsx)(n.p,{children:"For complete Android setup instructions including Google Play Console configuration, app setup, and testing guidelines, please visit:"}),"\n",(0,i.jsxs)(n.p,{children:["\ud83d\udc49 ",(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.a,{href:"https://openiap.dev/docs/android-setup",children:"Android Setup Guide - openiap.dev"})})]}),"\n",(0,i.jsx)(n.p,{children:"The guide covers:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Google Play Console configuration"}),"\n",(0,i.jsx)(n.li,{children:"App bundle setup and signing"}),"\n",(0,i.jsx)(n.li,{children:"Testing with internal testing tracks"}),"\n",(0,i.jsx)(n.li,{children:"Common troubleshooting steps"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"app-configuration",children:"App Configuration"}),"\n",(0,i.jsx)(n.p,{children:"Expo IAP automatically handles most Android configuration. The required billing permissions and dependencies are included automatically."}),"\n",(0,i.jsx)(n.h2,{id:"code-integration",children:"Code Integration"}),"\n",(0,i.jsx)(n.h3,{id:"basic-setup",children:"Basic Setup"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-tsx",children:"import {useIAP, ErrorCode} from 'expo-iap';\n\nconst androidProductIds = [\n  'premium_upgrade',\n  'coins_100',\n  'monthly_subscription',\n];\n\nfunction App() {\n  const {\n    connected,\n    products,\n    subscriptions,\n    requestProducts,\n    requestPurchase,\n  } = useIAP({\n    onPurchaseSuccess: (purchase) => {\n      console.log('Purchase successful:', purchase);\n      handleSuccessfulPurchase(purchase);\n    },\n    onPurchaseError: (error) => {\n      console.error('Purchase failed:', error);\n      handlePurchaseError(error);\n    },\n  });\n\n  React.useEffect(() => {\n    if (connected) {\n      // Fetch products and subscriptions\n      requestProducts({\n        skus: androidProductIds.filter((id) => !id.includes('subscription')),\n        type: 'inapp'\n      });\n      requestProducts({\n        skus: androidProductIds.filter((id) => id.includes('subscription')),\n        type: 'subs'\n      });\n    }\n  }, [connected]);\n\n  return (\n    <View>\n      {/* Render products */}\n      {products.map((product) => (\n        <AndroidProductItem key={product.id} product={product} />\n      ))}\n\n      {/* Render subscriptions */}\n      {subscriptions.map((subscription) => (\n        <AndroidSubscriptionItem\n          key={subscription.id}\n          subscription={subscription}\n        />\n      ))}\n    </View>\n  );\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"android-specific-product-handling",children:"Android-Specific Product Handling"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-tsx",children:"const AndroidProductItem = ({product}: {product: Product}) => {\n  const {requestPurchase} = useIAP();\n\n  const handlePurchase = () => {\n    if (product.platform === 'android') {\n      requestPurchase({\n        request: {skus: [product.id]},\n        type: 'inapp',\n      });\n    }\n  };\n\n  if (product.platform !== 'android') return null;\n\n  return (\n    <TouchableOpacity onPress={handlePurchase}>\n      <Text>{product.title}</Text>\n      <Text>{product.oneTimePurchaseOfferDetails?.formattedPrice}</Text>\n    </TouchableOpacity>\n  );\n};\n"})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\ud83d\udca1 Cross-Platform Note:"})," This example shows Android-specific usage with ",(0,i.jsx)(n.code,{children:"skus"}),". For cross-platform compatibility, include both ",(0,i.jsx)(n.code,{children:"sku"})," and ",(0,i.jsx)(n.code,{children:"skus"})," in your request object. See the ",(0,i.jsx)(n.a,{href:"/docs/api/methods/core-methods#requestpurchase",children:"Core Methods"})," documentation for details."]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"\n### Android-Specific Subscription Handling\n\n```tsx\nconst AndroidSubscriptionItem = ({ subscription }: { subscription: SubscriptionProduct }) => {\n  const { requestPurchase } = useIAP();\n\n  const handleSubscribe = (offer: any) => {\n    if (subscription.platform === 'android') {\n      requestPurchase({\n        request: {\n          skus: [subscription.id],\n          subscriptionOffers: [{\n            sku: subscription.id,\n            offerToken: offer.offerToken,\n          }],\n        },\n        type: 'subs',\n      });\n    }\n  };\n\n  if (subscription.platform !== 'android') return null;\n\n  return (\n    <View>\n      <Text>{subscription.title}</Text>\n      {subscription.subscriptionOfferDetails?.map((offer) => (\n        <TouchableOpacity\n          key={offer.offerId}\n          onPress={() => handleSubscribe(offer)}\n        >\n          <Text>\n            {offer.pricingPhases.pricingPhaseList\n              .map(phase => `${phase.formattedPrice}/${phase.billingPeriod}`)\n              .join(' then ')\n            }\n          </Text>\n        </TouchableOpacity>\n      ))}\n    </View>\n  );\n};\n"})}),"\n",(0,i.jsx)(n.h3,{id:"error-handling-for-android",children:"Error Handling for Android"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-tsx",children:"const handleAndroidError = (error: PurchaseError) => {\n  switch (error.code) {\n    case ErrorCode.E_USER_CANCELLED:\n      // User cancelled - no action needed\n      break;\n    case ErrorCode.E_ITEM_UNAVAILABLE:\n      Alert.alert(\n        'Product Unavailable',\n        'This item is not available for purchase',\n      );\n      break;\n    case ErrorCode.E_SERVICE_ERROR:\n      Alert.alert('Service Error', 'Google Play services are unavailable');\n      break;\n    case ErrorCode.E_DEVELOPER_ERROR:\n      Alert.alert('Configuration Error', 'Please contact support');\n      break;\n    default:\n      Alert.alert('Purchase Failed', error.message);\n  }\n};\n"})}),"\n",(0,i.jsx)(n.h2,{id:"common-issues",children:"Common Issues"}),"\n",(0,i.jsx)(n.h3,{id:"product-ids-not-found",children:"Product IDs Not Found"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Problem"}),": Products return empty or show as unavailable ",(0,i.jsx)(n.strong,{children:"Solutions"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Verify product IDs match exactly between code and Play Console"}),"\n",(0,i.jsxs)(n.li,{children:["Ensure products are ",(0,i.jsx)(n.strong,{children:"Active"})," in Play Console"]}),"\n",(0,i.jsx)(n.li,{children:"Check that app is uploaded to at least Internal testing track"}),"\n",(0,i.jsx)(n.li,{children:"Verify the app package name matches"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"testing-issues",children:"Testing Issues"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Problem"}),': "Item not found" or "Authentication required" errors ',(0,i.jsx)(n.strong,{children:"Solutions"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Use Gmail accounts added as test users"}),"\n",(0,i.jsx)(n.li,{children:"Install app from testing track, not directly via ADB"}),"\n",(0,i.jsx)(n.li,{children:"Ensure test user has a valid payment method"}),"\n",(0,i.jsx)(n.li,{children:"Clear Google Play Store cache and data"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"purchase-flow-issues",children:"Purchase Flow Issues"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Problem"}),": Purchase dialog doesn't appear or fails immediately ",(0,i.jsx)(n.strong,{children:"Solutions"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Verify Google Play services are updated"}),"\n",(0,i.jsx)(n.li,{children:"Check device has valid Google account"}),"\n",(0,i.jsx)(n.li,{children:"Ensure app is properly signed"}),"\n",(0,i.jsx)(n.li,{children:"Test on different devices"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"subscription-issues",children:"Subscription Issues"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Problem"}),": Subscription offers not showing or failing ",(0,i.jsx)(n.strong,{children:"Solutions"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Verify base plans are properly configured"}),"\n",(0,i.jsx)(n.li,{children:"Check offer eligibility rules"}),"\n",(0,i.jsx)(n.li,{children:"Ensure proper offer token handling"}),"\n",(0,i.jsx)(n.li,{children:"Test with different user accounts"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Always test on real devices"})," - emulators may have issues with Google Play services"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Use proper product IDs"})," - follow reverse domain naming (com.yourapp.product)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Handle all error cases"})," - especially network and service errors"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Test with multiple accounts"})," - verify behavior for new and existing users"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Implement proper retry logic"})," - for transient failures"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Cache purchase state"})," - to handle app restarts gracefully"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"android-specific-features",children:"Android-Specific Features"}),"\n",(0,i.jsx)(n.h3,{id:"proration-for-subscription-changes",children:"Proration for Subscription Changes"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-tsx",children:"const upgradeSubscription = async (\n  newSkuId: string,\n  oldPurchaseToken: string,\n) => {\n  try {\n    await requestPurchase({\n      request: {\n        skus: [newSkuId],\n        subscriptionOffers: [\n          {\n            sku: newSkuId,\n            offerToken: 'new_offer_token',\n          },\n        ],\n        replacementMode: 'IMMEDIATE_WITH_TIME_PRORATION',\n        oldPurchaseToken: oldPurchaseToken,\n      },\n      type: 'subs',\n    });\n  } catch (error) {\n    console.error('Subscription upgrade failed:', error);\n  }\n};\n"})}),"\n",(0,i.jsx)(n.h3,{id:"pending-purchases",children:"Pending Purchases"}),"\n",(0,i.jsx)(n.p,{children:"Handle purchases that require additional verification:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-tsx",children:"const handlePendingPurchase = (purchase: Purchase) => {\n  if (purchase.purchaseState === 'pending') {\n    // Show pending message to user\n    Alert.alert(\n      'Purchase Pending',\n      'Your purchase is being processed. You will receive access once payment is confirmed.',\n    );\n\n    // Store pending purchase for later verification\n    storePendingPurchase(purchase);\n  }\n};\n"})}),"\n",(0,i.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"../guides/getting-started",children:"Learn about getting started guide"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"./setup-ios",children:"Explore iOS setup"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"../api/error-codes",children:"Understand error codes"})}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(u,{...e})}):u(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>c});var r=s(6540);const i={},t=r.createContext(i);function o(e){const n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);